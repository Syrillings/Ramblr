<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user.username }}'s Profile - Ramblr</title>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <style>
/* Profile header */
.profile-header {
  max-width: 600px;
  margin: 30px auto 40px;
  text-align: center;
  padding: 20px;
  background-color: #f9faff;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0, 74, 173, 0.1);
  position: relative;
}

.profile-picture {
  width: 160px;
  height: 160px;
  border-radius: 50%;
  border: 5px solid #004aad;
  object-fit: cover;
  margin-bottom: 15px;
  box-shadow: 0 0 10px rgba(0, 74, 173, 0.3);
}

.no-profile-pic {
  font-size: 1.1em;
  color: #777;
  margin-bottom: 15px;
}

.profile-header h2 {
  font-size: 2.2em;
  color: #004aad;
  margin-bottom: 20px;
  font-weight: 700;
}

/* Upload form */
.upload-form {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  flex-wrap: wrap;
}

.upload-label {
  cursor: pointer;
  color: #004aad;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 1.1em;
  user-select: none;
  transition: color 0.3s ease;
}

.upload-label:hover {
  color: #002f6c;
}

.upload-button {
  background-color: #004aad;
  color: white;
  border: none;
  padding: 10px 22px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: background-color 0.3s ease;
}

.upload-button:hover {
  background-color: #003b8c;
}

/* Divider */
.divider {
  height: 4px;
  background-color: #004aad;
  max-width: 600px;
  margin: 0 auto 40px;
  border-radius: 2px;
}

/* Container */
.container {
  max-width: 800px;
  margin: auto;
  padding: 0 20px 40px;
  display: flex;
  flex-direction: column;
}

.container h2 {
  text-align: center;
  color: #004aad;
  margin-bottom: 30px;
  font-size: 2em;
  font-weight: 700;
}

/* Posts */
.post {
  background-color: white;
  padding: 25px 30px;
  border-radius: 12px;
  margin-bottom: 30px;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.07);
  border-left: 6px solid #004aad;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.post:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
}

.post.no-posts {
  text-align: center;
  font-style: italic;
  color: #666;
  border-left: none;
  box-shadow: none;
  padding: 20px;
}

/* Post header */
.post-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
}

.post-profile-pic {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #004aad;
  box-shadow: 0 0 6px rgba(0, 74, 173, 0.2);
}

.post-username {
  font-weight: 700;
  font-size: 1.1em;
  color: #004aad;
}

/* Post title */
.post h3 {
  margin: 0 0 12px;
  font-size: 1.6em;
  color: #003b8c;
}

/* Topic preview */
.topic-preview {
  font-size: 1.1em;
  line-height: 1.5;
  color: #444;
  margin-bottom: 18px;
}

.read-more {
  color: #0066ff;
  font-weight: 600;
  text-decoration: none;
  margin-left: 6px;
  transition: color 0.2s ease;
}

.read-more:hover {
  color: #004aad;
  text-decoration: underline;
}

/* Post actions */
.post-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.like-btn {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 18px;
  color: #004aad;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: color 0.3s ease;
}

.like-btn:hover {
  color: #002f6c;
}

/* Three dots menu */
.threedots-menu {
  background-color: transparent;
  color: #004aad;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 22px;
  transition: background-color 0.3s ease;
  position: relative;
}

.threedots-menu:hover {
  background-color: rgba(0, 74, 173, 0.1);
}

/* Popup menu */
.popup-menu {
  position: absolute;
  right: 0;
  top: 110%;
  background: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  min-width: 140px;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.2s ease;
}

.popup-menu.show {
  opacity: 1;
  position: absolute;
  right: 0;
  visibility: visible;
  transform: translateY(0);
}

.popup-menu ul {
  list-style: none;
  padding: 8px 0;
  margin: 0;
}

.popup-menu li {
  padding: 10px 18px;
  cursor: pointer;
  transition: background-color 0.2s;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 15px;
  color: #004aad;
}

.popup-menu li:hover {
  background-color: #e3f2fd;
}

.popup-menu li:last-child:hover {
  background-color: #ffebee;
  color: #c62828;
}

.popup-menu a {
  color: inherit;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
}

/* Comments */
.comments {
  margin-top: 15px;
  border-top: 1px solid #ddd;
  padding-top: 15px;
}

.comment {
  font-size: 15px;
  margin-bottom: 12px;
  padding: 12px 15px;
  background: #f7f9ff;
  border-radius: 8px;
  border-left: 4px solid #d0e0ff;
  color: #333;
}

.comment strong {
  color: #004aad;
}

/* Comment form */
.comment-form {
  margin-top: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.comment-form input[type="text"] {
  width: 100%;
  padding: 12px 15px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1em;
  transition: border-color 0.3s ease;
}

.comment-form input[type="text"]:focus {
  border-color: #004aad;
  outline: none;
}

.comment-form button {
  padding: 12px 0;
  background-color: #004aad;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  font-size: 1em;
  transition: background-color 0.3s ease;
}

.comment-form button:hover {
  background-color: #003b8c;
}

/* See all comments link */
.see-all-comments {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 10px;
}

.view-comments-btn {
  background: none;
  border: none;
  color: #004aad;
  cursor: pointer;
  font-size: 14px;
  padding: 5px 0;
  text-decoration: none;
  font-weight: 600;
  transition: color 0.3s ease;
}

.view-comments-btn:hover {
  color: #003b8c;
  text-decoration: underline;
}

/* Bottom navigation */
.bottom-nav {

  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 30px;
  padding: 15px 0;
  background-color: #004aad;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0, 74, 173, 0.2);
}

.bottom-nav a {
  color: white;
  text-decoration: none;
  padding: 12px 28px;
  border-radius: 8px;
  font-weight: 700;
  font-size: 1.1em;
  transition: background-color 0.3s ease;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
}

.bottom-nav a:hover {
  background-color: #003b8c;
}

/* Set normal, clean font-family globally */
body, input, button, select, textarea {
  font-family: Arial, Helvetica, sans-serif;
  /* You can also use: font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; */
}

/* Back button styling */
.back-button {
  position: fixed;
  top: 20px;
  left: 20px;
  background-color: #004aad;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: background-color 0.3s ease;
  z-index: 2000;
  text-decoration: none;
}

.back-button ion-icon {
  font-size: 22px;
}

.back-button:hover {
  background-color: #003b8c;
}

/* Adjust container top padding to avoid overlap with fixed back button */
body {
  padding-top: 70px;
}

/* Responsive */
@media (max-width: 700px) {
  .profile-header {
    max-width: 90%;
    padding: 15px;
  }

  .profile-picture {
    width: 130px;
    height: 130px;
  }

  .container {
    padding: 0 15px 30px;
  }

  .post {
    padding: 20px 20px;
  }

  .post-profile-pic {
    width: 40px;
    height: 40px;
  }

  .post h3 {
    font-size: 1.3em;
  }

.bottom-nav {
        flex-direction: column;
        padding: 15px;
        gap: 20px;
        border-radius: 0%;
      }

.bottom-nav a {
        font-size: 1em;
        margin-left: 10px;
        margin-right: 10px;
        padding: 10px 0;
        text-align: center;
        border-radius: none;

      }
}

@media (max-width: 400px) {
  .upload-form {
    flex-direction: column;
    gap: 10px;
  }

  .upload-button {
    width: 100%;
  }
}

.stats-container {
  display: flex;
  justify-content: space-around;
  margin-bottom: 20px;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.stat-number {
  font-size: 1.5em;
  font-weight: 700;
  margin-bottom: 5px;
}

.stat-label {
  font-size: 1em;
  color: #666;
}

.activity-section {
  margin-bottom: 30px;
}

.activity-item {
  padding: 15px;
  border-bottom: 1px solid #ddd;
}

.activity-item:last-child {
  border-bottom: none;
}

.activity-title {
  font-size: 1.2em;
  font-weight: 700;
  margin-bottom: 5px;
  text-decoration: none;
  color: #004aad;
}

.activity-meta {
  font-size: 1em;
  color: #666;
}

.comment-preview {
  margin-bottom: 10px;
}

.comment-on {
  font-size: 1em;
  color: #666;
}

.comment-topic {
  font-size: 1em;
  font-weight: 700;
  text-decoration: none;
  color: #004aad;
}

.comment-content {
  font-size: 1em;
  color: #444;
}
    </style>
</head>
<body>
    
<a href="/home" class="back-button" aria-label="Go back to home">
  <ion-icon name="caret-back-outline"></ion-icon> Back
</a>

<div class="profile-header">
  {% if user.profile_pic %}
  <img class="profile-picture" src="{{ url_for('static', filename=user.profile_pic) }}" alt="Profile Picture">
  
  {% else %}
  <div class="no-profile-pic">No profile picture</div>
  {% endif %}
  <h2>{{ user.username }}'s Profile</h2>
  <div class="stats-container">
    <div class="stat-item">
      <span class="stat-number">{{ user_stats.topic_count }}</span>
      <span class="stat-label">Topics</span>
    </div>
    <div class="stat-item">
      <span class="stat-number">{{ user_stats.comment_count }}</span>
      <span class="stat-label">Comments</span>
    </div>
    <div class="stat-item">
      <span class="stat-number">{{ user_stats.likes_received }}</span>
      <span class="stat-label">Likes</span>
    </div>
  </div>
  <form action="/upload_profile_pic" method="POST" enctype="multipart/form-data" class="upload-form">
    <label for="profile_pic" class="upload-label">
      <ion-icon name="pencil-outline"></ion-icon> Change Picture
    </label>
    
    <input type="file" id="profile_pic" name="profile_pic" accept="image/*" required hidden>

    <span id="file-name" style="margin-left:10px; font-style:italic;"></span>

    <button type="submit" class="upload-button">Upload</button>
  </form>
</div>

<div class="divider"></div>

<div class="container">
  <h2>Recent Activity</h2>
  
  <div class="activity-section">
    <h3>Recent Topics</h3>
    {% if user_activity.topics %}
        {% for topic in user_activity.topics %}
        <div class="activity-item">
          <a href="{{ url_for('topic_detail', topic_id=topic.id) }}" class="activity-title">
            {{ topic.title }}
          </a>
          <div class="activity-meta">
            <span>{{ topic.created_at }}</span>
            <span>•</span>
            <span>💬 {{ topic.comment_count }} comments</span>
            <span>•</span>
            <span>❤️ {{ topic.likes }} likes</span>
          </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="no-activity">No topics yet.</p>
    {% endif %}
  </div>

  <div class="activity-section">
    <h3>Recent Comments</h3>
    {% if user_activity.comments %}
        {% for comment in user_activity.comments %}
        <div class="activity-item">
          <div class="comment-preview">
            <span class="comment-on">On </span>
            <a href="{{ url_for('topic_detail', topic_id=comment.topic_id) }}" class="comment-topic">
              {{ comment.topic_title }}
            </a>
            <p class="comment-content">{{ comment.content }}</p>
          </div>
          <div class="activity-meta">
            <span>{{ comment.created_at }}</span>
          </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="no-activity">No comments yet.</p>
    {% endif %}
  </div>
</div>

<div class="bottom-nav">
  <a href="/home" class="nav-home">Home</a>
  <a href="/post" class="nav-post">New Post</a>
  <a href="/logout" class="nav-logout">Logout</a>
</div>

  <script>
    const hamburger = document.querySelector('.hamburger');
    const navMenu = document.querySelector('.nav-menu');
    const overlay = document.querySelector('.overlay');  const fileInput = document.getElementById('profile_pic');
    const fileNameDisplay = document.getElementById('file-name');

    fileInput.addEventListener('change', function () {
      if (this.files && this.files.length > 0) {
        fileNameDisplay.textContent = this.files[0].name;
      } else {
        fileNameDisplay.textContent = '';
      }
    });
    
    hamburger.addEventListener('click', () => {
      hamburger.classList.toggle('active');
      navMenu.classList.toggle('active');
      overlay.classList.toggle('active');
      
      // Update ARIA attributes for accessibility
      const isExpanded = hamburger.getAttribute('aria-expanded') === 'true';
      hamburger.setAttribute('aria-expanded', !isExpanded);
    });

    // Close menu when clicking on overlay
    overlay.addEventListener('click', () => {
      hamburger.classList.remove('active');
      navMenu.classList.remove('active');
      overlay.classList.remove('active');
      hamburger.setAttribute('aria-expanded', 'false');
    });

    function toggleMenu(event, topicId) {
      event.stopPropagation();
      const menu = document.getElementById(`menu-${topicId}`);
      const allMenus = document.querySelectorAll('.popup-menu');
      allMenus.forEach(m => {
        if (m !== menu) {
          m.classList.remove('show');
        }
      });

      menu.classList.toggle('show');
    }

    function editPost(topicId) {
      document.getElementById(`menu-${topicId}`).classList.remove('show');
      window.location.href = `/edit/${topicId}`;
    }

    function deletePost(topicId) {
      document.getElementById(`menu-${topicId}`).classList.remove('show');
      
      if (confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
        fetch(`/delete/${topicId}`, {
          method: 'POST',
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(response => {
          if (response.ok) {
            location.reload();
          } else {
            alert('Error deleting post. Please try again.');
          }
        })
        .catch(err => {
          console.error("Delete post error:", err);
          alert('Error deleting post. Please try again.');
        });
      }
    }
    document.addEventListener('click', () => {
      const allMenus = document.querySelectorAll('.popup-menu');
      allMenus.forEach(menu => {
        menu.classList.remove('show');
      });
    });

    function toggleLike(topicId) {
      fetch(`/like/${topicId}`, {
        method: 'POST',
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      .then(response => response.json())
      .then(data => {
        const icon = document.getElementById(`like-icon-${topicId}`);
        const likeCount = data.likes;

        if (likeCount > 0) {
          icon.textContent = data.liked ? `❤️ ${likeCount}` : `🤍 ${likeCount}`;
        } else {
          icon.textContent = `🤍`;
        }
      })
      .catch(err => console.error("Toggle like error:", err));
    }
  </script>



</body>
</html>